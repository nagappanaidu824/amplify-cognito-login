<!DOCTYPE html>
<html>
  <head>
    <title>Login with Cognito</title>
    <script>
      const domain = "https://ap-southeast-1afuovmigj.auth.ap-southeast-1.amazoncognito.com";
      const clientId = "7u4aik1atk0krdtfoc3cdoho1";
      const clientSecret = "vgs8upk2nrqjs4oon7t5kbgv1t9oi1b87dki4j03rckghti36d";
      const redirectUri = "https://main.d30ywk39l19qcq.amplifyapp.com";
      const code = new URLSearchParams(window.location.search).get("code");

      function showGallery() {
        document.body.innerHTML = `
          <h2>‚úÖ Welcome to the Image Gallery!</h2>
          <div style="display: flex; gap: 10px;">
            <img src="https://placekitten.com/200/200" onclick="openImage(this.src)" style="cursor:pointer;" />
            <img src="https://placekitten.com/201/200" onclick="openImage(this.src)" style="cursor:pointer;" />
            <img src="https://placekitten.com/202/200" onclick="openImage(this.src)" style="cursor:pointer;" />
          </div>
          <br><button onclick="logout()">üö™ Logout</button>
          <script>
            function openImage(src) {
              window.open(src, '_blank');
            }
            function logout() {
              window.location.href = "${domain}/logout?client_id=${clientId}&logout_uri=${redirectUri}";
            }
          </script>
        `;
      }

      if (code) {
        const basicAuth = btoa(`${clientId}:${clientSecret}`);
        fetch(`${domain}/oauth2/token`, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "Authorization": `Basic ${basicAuth}`
          },
          body: new URLSearchParams({
            grant_type: "authorization_code",
            code: code,
            redirect_uri: redirectUri
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.id_token) {
            localStorage.setItem("id_token", data.id_token);
            showGallery();
          } else {
            document.body.innerHTML = `<h2>‚ùå Failed to login</h2><pre>${JSON.stringify(data, null, 2)}</pre>`;
          }
        })
        .catch(err => {
          document.body.innerHTML = `<h2>‚ùå Error</h2><pre>${err.message}</pre>`;
        });
      } else {
        // Redirect to Cognito login
        window.location.href = `${domain}/login?client_id=${clientId}&response_type=code&scope=openid+email+phone&redirect_uri=${redirectUri}`;
      }
    </script>
  </head>
  <body>
    <p>Loading...</p>
  </body>
</html>
